const menuData = {
  'coffee': [{
    "name": "Irish coffee",
    'img': '../img/menu/coffee/coffee-1.jpg',
    "description": "Fragrant black coffee with Jameson Irish whiskey and whipped milk",
    "price": "7.00",
    "category": "coffee",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Cinnamon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  },

  {
    "name": "Kahlua coffee",
    'img': '../img/menu/coffee/coffee-2.jpg',
    "description": "Classic coffee with milk and Kahlua liqueur under a cap of frothed milk",
    "price": "7.00",
    "category": "coffee",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Cinnamon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  },

  {
    "name": "Honey raf",
    'img': '../img/menu/coffee/coffee-3.jpg',
    "description": "Espresso with frothed milk, cream and aromatic honey",
    "price": "5.50",
    "category": "coffee",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Cinnamon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  },

  {
    "name": "Ice cappuccino",
    'img': '../img/menu/coffee/coffee-4.jpg',
    "description": "Cappuccino with soft thick foam in summer version with ice",
    "price": "5.00",
    "category": "coffee",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Cinnamon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  },

  {
    "name": "Espresso",
    'img': '../img/menu/coffee/coffee-5.jpg',
    "description": "Classic black coffee",
    "price": "4.50",
    "category": "coffee",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Cinnamon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  },

  {
    "name": "Latte",
    'img': '../img/menu/coffee/coffee-6.jpg',
    "description": "Espresso coffee with the addition of steamed milk and dense milk foam",
    "price": "5.50",
    "category": "coffee",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Cinnamon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  },

  {
    "name": "Latte macchiato",
    'img': '../img/menu/coffee/coffee-7.jpg',
    "description": "Espresso with frothed milk and chocolate",
    "price": "5.50",
    "category": "coffee",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Cinnamon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  },

  {
    "name": "Coffee with cognac",
    'img': '../img/menu/coffee/coffee-8.jpg',
    "description": "Fragrant black coffee with cognac and whipped cream",
    "price": "6.50",
    "category": "coffee",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Cinnamon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  }],
  // tea
  'tea': [{
    "name": "Moroccan",
    'img': '../img/menu/tea/tea-1.png',
    "description": "Fragrant black tea with the addition of tangerine, cinnamon, honey, lemon and mint",
    "price": "4.50",
    "category": "tea",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Lemon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  },

  {
    "name": "Ginger",
    'img': '../img/menu/tea/tea-2.png',
    "description": "Original black tea with fresh ginger, lemon and honey",
    "price": "5.00",
    "category": "tea",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Lemon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  },

  {
    "name": "Cranberry",
    'img': '../img/menu/tea/tea-3.png',
    "description": "Invigorating black tea with cranberry and honey",
    "price": "5.00",
    "category": "tea",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Lemon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  },

  {
    "name": "Sea buckthorn",
    'img': '../img/menu/tea/tea-4.png',
    "description": "Toning sweet black tea with sea buckthorn, fresh thyme and cinnamon",
    "price": "5.50",
    "category": "tea",
    "sizes": {
      "s": {
        "size": "200 ml",
        "add-price": "0.00"
      },
      "m": {
        "size": "300 ml",
        "add-price": "0.50"
      },
      "l": {
        "size": "400 ml",
        "add-price": "1.00"
      }
    },
    "additives": [
      {
        "name": "Sugar",
        "add-price": "0.50"
      },
      {
        "name": "Lemon",
        "add-price": "0.50"
      },
      {
        "name": "Syrup",
        "add-price": "0.50"
      }
    ]
  }],
  'dessert': [
    {
      "name": "Marble cheesecake",
      'img': "../img/menu/dessert/dessert-1.png",
      "description": "Philadelphia cheese with lemon zest on a light sponge cake and red currant jam",
      "price": "3.50",
      "category": "dessert",
      "sizes": {
        "s": {
          "size": "50 g",
          "add-price": "0.00"
        },
        "m": {
          "size": "100 g",
          "add-price": "0.50"
        },
        "l": {
          "size": "200 g",
          "add-price": "1.00"
        }
      },
      "additives": [
        {
          "name": "Berries",
          "add-price": "0.50"
        },
        {
          "name": "Nuts",
          "add-price": "0.50"
        },
        {
          "name": "Jam",
          "add-price": "0.50"
        }
      ]
    },

    {
      "name": "Red velvet",
      'img': "../img/menu/dessert/dessert-2.png",
      "description": "Layer cake with cream cheese frosting",
      "price": "4.00",
      "category": "dessert",
      "sizes": {
        "s": {
          "size": "50 g",
          "add-price": "0.00"
        },
        "m": {
          "size": "100 g",
          "add-price": "0.50"
        },
        "l": {
          "size": "200 g",
          "add-price": "1.00"
        }
      },
      "additives": [
        {
          "name": "Berries",
          "add-price": "0.50"
        },
        {
          "name": "Nuts",
          "add-price": "0.50"
        },
        {
          "name": "Jam",
          "add-price": "0.50"
        }
      ]
    },

    {
      "name": "Cheesecakes",
      'img': "../img/menu/dessert/dessert-3.png",
      "description": "Soft cottage cheese pancakes with sour cream and fresh berries and sprinkled with powdered sugar",
      "price": "4.50",
      "category": "dessert",
      "sizes": {
        "s": {
          "size": "50 g",
          "add-price": "0.00"
        },
        "m": {
          "size": "100 g",
          "add-price": "0.50"
        },
        "l": {
          "size": "200 g",
          "add-price": "1.00"
        }
      },
      "additives": [
        {
          "name": "Berries",
          "add-price": "0.50"
        },
        {
          "name": "Nuts",
          "add-price": "0.50"
        },
        {
          "name": "Jam",
          "add-price": "0.50"
        }
      ]
    },

    {
      "name": "Creme brulee",
      'img': "../img/menu/dessert/dessert-4.png",
      "description": "Delicate creamy dessert in a caramel basket with wild berries",
      "price": "4.00",
      "category": "dessert",
      "sizes": {
        "s": {
          "size": "50 g",
          "add-price": "0.00"
        },
        "m": {
          "size": "100 g",
          "add-price": "0.50"
        },
        "l": {
          "size": "200 g",
          "add-price": "1.00"
        }
      },
      "additives": [
        {
          "name": "Berries",
          "add-price": "0.50"
        },
        {
          "name": "Nuts",
          "add-price": "0.50"
        },
        {
          "name": "Jam",
          "add-price": "0.50"
        }
      ]
    },

    {
      "name": "Pancakes",
      'img': "../img/menu/dessert/dessert-5.png",
      "description": "Tender pancakes with strawberry jam and fresh strawberries",
      "price": "4.50",
      "category": "dessert",
      "sizes": {
        "s": {
          "size": "50 g",
          "add-price": "0.00"
        },
        "m": {
          "size": "100 g",
          "add-price": "0.50"
        },
        "l": {
          "size": "200 g",
          "add-price": "1.00"
        }
      },
      "additives": [
        {
          "name": "Berries",
          "add-price": "0.50"
        },
        {
          "name": "Nuts",
          "add-price": "0.50"
        },
        {
          "name": "Jam",
          "add-price": "0.50"
        }
      ]
    },

    {
      "name": "Honey cake",
      'img': "../img/menu/dessert/dessert-6.png",
      "description": "Classic honey cake with delicate custard",
      "price": "4.50",
      "category": "dessert",
      "sizes": {
        "s": {
          "size": "50 g",
          "add-price": "0.00"
        },
        "m": {
          "size": "100 g",
          "add-price": "0.50"
        },
        "l": {
          "size": "200 g",
          "add-price": "1.00"
        }
      },
      "additives": [
        {
          "name": "Berries",
          "add-price": "0.50"
        },
        {
          "name": "Nuts",
          "add-price": "0.50"
        },
        {
          "name": "Jam",
          "add-price": "0.50"
        }
      ]
    },

    {
      "name": "Chocolate cake",
      'img': "../img/menu/dessert/dessert-7.png",
      "description": "Cake with hot chocolate filling and nuts with dried apricots",
      "price": "5.50",
      "category": "dessert",
      "sizes": {
        "s": {
          "size": "50 g",
          "add-price": "0.00"
        },
        "m": {
          "size": "100 g",
          "add-price": "0.50"
        },
        "l": {
          "size": "200 g",
          "add-price": "1.00"
        }
      },
      "additives": [
        {
          "name": "Berries",
          "add-price": "0.50"
        },
        {
          "name": "Nuts",
          "add-price": "0.50"
        },
        {
          "name": "Jam",
          "add-price": "0.50"
        }
      ]
    },

    {
      "name": "Black forest",
      'img': "../img/menu/dessert/dessert-8.png",
      "description": "A combination of thin sponge cake with cherry jam and light chocolate mousse",
      "price": "6.50",
      "category": "dessert",
      "sizes": {
        "s": {
          "size": "50 g",
          "add-price": "0.00"
        },
        "m": {
          "size": "100 g",
          "add-price": "0.50"
        },
        "l": {
          "size": "200 g",
          "add-price": "1.00"
        }
      },
      "additives": [
        {
          "name": "Berries",
          "add-price": "0.50"
        },
        {
          "name": "Nuts",
          "add-price": "0.50"
        },
        {
          "name": "Jam",
          "add-price": "0.50"
        }
      ]
    }
  ]
},
  gallery = document.querySelector('.gallery'),
  refreshBtn = document.querySelector('.gallery-refresh-btn');

let visibleProductsCount = 0,
  category = 'coffee',
  narrowWidth = 'false',
  fullWidth = false,
  productSize = 's';

window.addEventListener('resize', handleResize);

function handleResize() {
  if (window.innerWidth > 768 && !fullWidth) {
    fullWidth = true;
    displayMenu(category);
    toggleRefreshButtonVisibility()
  };
  if (window.innerWidth <= 768 && fullWidth) {
    fullWidth = false;
    displayMenu(category);
    toggleRefreshButtonVisibility();
  }

}

function toggleItemVisibility() {
  document.querySelector('#item-prompt').classList.toggle('hidden');
};

function clearSelectedLabels() {
  document.querySelectorAll('.item-btn')
    .forEach((el) => {
      el.classList.remove('selected');
    });
}

const displayItemPrompt = (key) => {
  document.querySelector('.data-key').setAttribute('data-key', key);
  document.querySelector('#prompt-title').innerText = `${menuData[category][key].name}`;
  document.querySelector('#prompt-subtitle').innerText = `${menuData[category][key].description}`;
  document.querySelector('#prompt-price').innerText =
    `$${(+menuData[category][key].price).toFixed(2)}`;
  switch (category) {
    case 'tea':
      document.querySelector('#additive2').innerText = 'Lemon';
      break;
    case 'dessert':
      document.querySelector('#additive1').innerText = 'Berries';
      document.querySelector('#additive2').innerText = 'Nuts';
      document.querySelector('#additive3').innerText = 'Jam';
      document.querySelector('#sizeVolume1').innerText = '50 g';
      document.querySelector('#sizeVolume2').innerText = '100 g';
      document.querySelector('#sizeVolume3').innerText = '200 g';
      break;
    default: break;
  }
  document.querySelector('#additive1').innerText
  document.querySelector('#prompt-img').setAttribute('src', menuData[category][key].img);
  toggleItemVisibility();
}

function setSelectedLabel() {
  const labelList = document.querySelectorAll('.item-btn');

  labelList.forEach((el) => {
    if (el.previousElementSibling.checked === true) {
      el.classList.add('selected');
      if (el.classList.contains('size-label')) {
        productSize = el.getAttribute('for').split('-')[2];
        document.querySelector('#prompt-price').innerText =
          `$${(+menuData[category][document.querySelector('.data-key').getAttribute('data-key')].price + +menuData[category][document.querySelector('.data-key').getAttribute('data-key')].sizes[productSize]['add-price']).toFixed(2)}`;
      }
    } else {
      el.classList.remove('selected')
    }
  })
  let selectedAdditionsNumber = 0;
  document.querySelectorAll('.item-add').forEach((el) => {
    if (el.checked === true) {
      selectedAdditionsNumber += 1;
    }
  })
  document.querySelector('#prompt-price').innerText =
    `$${(+menuData[category][document.querySelector('.data-key').getAttribute('data-key')].price + +menuData[category][document.querySelector('.data-key').getAttribute('data-key')].sizes[productSize]['add-price'] + selectedAdditionsNumber * 0.5).toFixed(2)}`;


};

function setActiveCategory(category) {
  const buttons = document.querySelectorAll('.menu-nav-btn');

  buttons.forEach(button => {
    button.classList.remove('selected');
  });

  const activeButton = Array.from(buttons).find(button => button.textContent.toLowerCase().includes(category));
  if (activeButton) {
    activeButton.classList.add('selected');
  }
}

// Handle category button clicks
document.addEventListener('DOMContentLoaded', function () {
  displayMenu('coffee');
  const buttons = document.querySelectorAll('.menu-nav-btn');
  buttons.forEach(button => {
    button.addEventListener('click', function () {
      category = this.getAttribute('data-category');
      displayMenu(category);
      setActiveCategory(category);
      const visibleProductsCount = document.querySelectorAll('.card').length;
      toggleRefreshButtonVisibility();
    });
  });
});

function toggleRefreshButtonVisibility() {
  if (menuData[category].length > visibleProductsCount) {
    refreshBtn.classList.remove('hidden');
  } else {
    refreshBtn.classList.add('hidden');
  }
}

function displayMenu(category) {
  const gallery = document.querySelector('.gallery');

  gallery.innerHTML = '';

  if (menuData[category] && Array.isArray(menuData[category])) {
    const isMobile = window.innerWidth <= 768;
    visibleProductsCount = isMobile ? 4 : 8; // Assign the value
    menuData[category].length < visibleProductsCount ? visibleProductsCount = menuData[category].length : null;
    const productsToDisplay = menuData[category].slice(0, visibleProductsCount);


    for (let i = 0; i < visibleProductsCount; i += 1) {
      insertCard({ el: productsToDisplay[i], index: i, gallery });
    }

    getCardKey();
  }
}

function insertCard({ el, index, gallery }) {
  gallery.insertAdjacentHTML('beforeend', `
        <div class='card' key=${index}>
          <div class='image-container'>
            <img
              class='card-img'
              src=${el.img} 
              alt='${el.name} photo'>
          </div>
          <div class='content-container'>
            <h3 class='heading-3'>${el.name}</h3>
            <p class='body-medium'>${el.description}</p>
            <p class='heading-3'>$<span>${el.price}</span></p>
          </div>
        </div>
      `);
};

function toggleVerticalScroll() {
  document.querySelector('body').classList.toggle('modal-open')
};

function getCardKey() {
  document.querySelectorAll('.card').forEach((el) => {
    el.addEventListener('click', () => {
      displayItemPrompt(el.getAttribute('key'));
      toggleVerticalScroll();
    });
  })
};

document.querySelector('.item-content-wrapper').addEventListener('click', (e) => {
  e.stopPropagation();
});

document.querySelector('.item-details').addEventListener('click', closeModal);

document.querySelectorAll('.item-btn').forEach((el) => {
  el.addEventListener('click', () => setTimeout(() => {
    clearSelectedLabels();
    setSelectedLabel();
  }));
});

refreshBtn.addEventListener('click', () => {
  const visibleProductsCount = document.querySelectorAll('.card').length;
  if (menuData[category].length > visibleProductsCount) {
    menuData[category].slice(visibleProductsCount, menuData[category].length).map((el, index) => {
      insertCard({ el, index: index + visibleProductsCount, gallery: document.querySelector('.gallery') })
    })
  }
  refreshBtn.classList.add('hidden');
})

displayMenu();

function closeModal() {
  productSize = 's';
  clearSelectedLabels();
  document.querySelectorAll('.item-add').forEach((el) => el.checked = false)
  document.getElementById('item-size-s').checked = true;
  document.getElementById('item-size-s').nextElementSibling.classList.add('selected');
  toggleItemVisibility();
  toggleVerticalScroll();
}

document.querySelector('.item-close-btn').addEventListener('click', closeModal);
